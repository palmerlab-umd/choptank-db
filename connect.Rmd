---
title: "General database interactions"
output:
  html_document:
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(magrittr)
```

# Connect

First load the `RPostgreSQL` library in order to access its functions. 

```{r}
library(RPostgreSQL)
```

## Password

In addition to the type, location, and name of the databse, you need to specify a username and password. The username is `palmergroup`. The password should be saved in a hidden file in your home directory so that it does not accidentally get shared. If you have the password saved as plain text in a file called `.pgpass`, you can read it in as character string using the `scan()` function:

```{r pw}
password <- scan(".pgpass", what="")
```

For better options on password handling, see the [PostgreSQL documentation](https://www.postgresql.org/docs/8.1/static/libpq-pgpass.html) or the [SESYNC Research Support FAQ page](https://collab.sesync.org/sites/support/_layouts/15/start.aspx#/Frequently%20Asked%20Questions/Connecting%20RStudio%20Server%20or%20Desktop%20to%20a%20database.aspx)

## Create connection object

Once you have the password, create a database connection using the `dbConnect()` function. These guides will always use the name `db` for the connection object. All of the functions that send and receive information from the database will have this as the first argument. 

```{r}
db <- dbConnect(PostgreSQL(), 
                host = "sesync-postgis01.research.sesync.org",
                dbname = "choptank", 
                user = "palmergroup",
                password = password)
```

__Some examples to see if it's working__

This function will list all of the tables in the database. 

```{r}
dbListTables(db) %>% head()
```

If you want to read a whole table from the database into your R environment, you can use `dbReadTable()`. 

```{r}
samplingfeatures <- dbReadTable(db, c("odm2", "samplingfeatures"))
```

Disconnect at the end of your session

```{r}
dbDisconnect(db)
```

